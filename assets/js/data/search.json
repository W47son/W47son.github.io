[ { "title": "Análisis y reporte del chrome stealer - ChromeUpdater.exe", "url": "/posts/analisis-reporte-malware-chrome-stealer/", "categories": "Malware Analysis, Stealer", "tags": "Malware, Stealer, Golang", "date": "2023-08-21 15:00:00 +0200", "snippet": "Analizar los propios malwares personalizados es vital para saber detectarlos posteriormente. Por ello, he creado un malware stealer de credenciales en Golang.Toda la infraestructura está creada y ejecutada de forma local, por lo que no sale fuera de la red.OffensiveGolang es uno de los uno de los repositorios que me ha facilitado la programación como el desarrollo del exfiltrado de datos, para crearlo. Muy recomendable.https://github.com/MrTuxx/OffensiveGolang/tree/mainPara ofuscar el malware he utilizado esta herramienta que es la cual luego un simple comando strings no puede encontrar mucho y el análisis es más complicado y duradero.Con garble utilicé también una semilla de aleatoriedad de ofuscación.https://github.com/burrowers/garblePara la recolección de todos estos archivos exfiltrados, los recibí en un Kali Linux donde tenía levantado un Flask app.El malware no es detectado por el antivirus windows defender ya que es desconocido y no puede basarse en los signatures y la detección estática es bypasseada.A continuación, voy a escribir un informe donde podemos ver el funcionamiento del malware:Resumen ejecutivoChromeUpdater es un stealer en busca de exfiltrar artefactos de Google Chrome como por ejemplo: contraseñas y cookies. El malware encripta los archivos en AES y los exfiltra a una IP privada.El malware está programado en Golang para Windows.Los primeros indicadores son: Al iniciarlo solo se muestra en la barra de tareas Esta aplicación solo dura milisegundos y se cierra Cuando se cierra, se borra así mismoResumen técnico de alto nivelLo primero que hace el stealer es una busqueda de los siguientes archivos del path de ‘/AppData/Local/Google/Chrome/User Data’: Cookies History Web Data Bookmarks Login Data Local StateDespués de leer los archivos, los encripta con una clave “01234567890abcdef” AES.Hace una conexión con httx://10.10.10.6:8080/endpoint y envia los archivos a través de un método POST en forma de JSON (clave valor) y una vez finalizado, procede a borrarse a si mismo con un cmd.exe /C del.Composición de malwarechromeUpdater.exeSHA256 Hash:FF6AFE9A7FF8D8C451CCBD3C5A0F473025D36074173A027B39FEECE45E78DA63MD5 Hash:0194AF976819E40CC63AD795D1F5CACEAnálisis estáticoEste malware no ofrece ningún tipo de “Time Date Stamp” en PEViewEn las propiedades del ejecutable no encontramos alguna descripción ni versión ni nombre ni tampoco alguna firma digital.Como vemos ahora y veremos después, el lenguaje es Golang y está escrito para Windows.Llevando el archivo a PEStudio, confirmamos que no hay ningún compiler-stamp ni firma, ni otro tipo de informaciónAlgunas de las API a las que llama son para tratar hilos y es por eso que parecen del tipo Process Injection pero no hay más con “flag” interesantesExtrayendo los strings a un documento vemos que está escrito en Golang por la terminación “.go” en muchos de los strings que hay y podemos ver el comportamiento en base a ello como syscall_windows.go, que hará llamadas al sistema que permiten a las aplicaciones interactuar con funciones de bajo nivel.Pasando el archivo de strings por malapi.py podemos ver que utiliza API para enumerar el directorio.Vemos que utiliza API para utilizar Internet, por lo que enviará o recibirá algo.También utiliza API helper para crear o abrir un archivo.Extrayendo las cadenas a través del comando “strings” no dejó más que los imports que hemos visto y que está escrito en golang.Utilizando floss podemos extraer los strings ofuscados de una forma más avanzada. Debido a la ofuscación, el proceso tarda un rato.Nos devuelve que hay 160.000 strings estáticas y de las tight strings que son descodificadas en la pila, obtenemos que es probable que acceda a los Bookmarks de Google Chrome y al archivo Local State donde reside la llave de encriptado.C:/Users//AppData/Local/Google/Chrome/User Data/Default/BookmarksjW/AppData/Local/Google/Chrome/User Data/Local Statehttp://10.10.10.6:8080/endpointO[0123456789abcdef*Afcrypto/cipher: input not full blockscrypto/aes: invalid key sizeTambién parece que accederá a un endpoint llamado endpoint y esa cadena en hexadecimal encriptará los archivos.Análisis dinámicoTeniendo en mente que accede a archivos y son de Chrome, podemos filtrar por ReadFile.Al ejecutar el programa vemos que ha accedido a todos esos archivos de ChromePosterior a ello, vemos que hubo una conexión al puerto 8080 de la 10.10.10.6 y envíos de información notables.Al analizarlo en Wireshark vemos que hubo un POST a /endpoint de menos de 1 MB y en formato JSONUtiliza un UserAgent genérico con un authorization custom con el nombre de W4tson y un Issued Time de Sat 15 July 2023 08:30:32 UTCTratando de decodificar la primera clave del JSON, vemos que no funciona.Asumimos que se utilizó el cifrado AES encontrado en los strings para cifrar este contenido, por lo que utilizando el string encontrado “0123456789abcdef” podemos descifrar que el texto encriptado era “w4tsonCookies” y el valor clave es el contenido del archivo.En Sysmon se observa que no hay ningún tipo de información del archivo a la hora de su ejecución.El ParentImage de este cmd.exe / c del es el mismo chromeUpdater de eliminándose a sí mismo después de ejecutarse.El event id 26 registra la eliminación del ejecutable.Vemos que registró la IP y el puerto de destino al que se conectó.DetecciónPor defecto, Windows no registra el acceso a archivos/carpetas (objetos), habilitamos la auditoría de objetos y supervisamos el archivo Local State.Después de su ejecución, podemos ver que el proceso chromeUpdater accedió al archivo.MitigaciónCon todos estos archivos exfiltrados, el atacante puede acceder a todas las contraseñas del navegador excepto si tienes guardadas tus contraseñas en un gestor de contraseñas como KeePass.También podrías utilizar Firefox y guardar tus contraseñas ahí, ya que te ofrece ponerle una master password." }, { "title": "Como montar un SIEM y EDR en Elastic Cloud GRATIS", "url": "/posts/como-montar-gratis-un-siem-edr-cloud/", "categories": "Tutorial, SIEM", "tags": "Tutorial, SIEM, Elastic, EDR", "date": "2023-06-14 17:00:00 +0200", "snippet": "Vamos a aprender a como montar un SIEM con Elastic en Cloud con su EDR activado y además ponerlo a prueba en una máquina Windows virtual.¿Qué es un SIEM?Un SIEM (Security Information and Event Management) es un programa de monitorización que recopila, analiza y correlaciona logs en tiempo real.Tener un SIEM es necesario por la capacidad de analizar logs fuera de la máquina, crear alertas en base a esos logs, integrar nuevas herramientas de detección y repuesta y al final correlacionar eventos en un entorno donde la comodidad y la velocidad de la muestra de los logs es importante.Registro ElasticLo primero de todo es registrarse en Elastic donde te darán 15 días gratis sin pedir tarjetahttps://cloud.elastic.co/registrationUna vez registrado te pedirán algunos datos que te los puedes inventarFinalmente, nos pedirá donde crear nuestro deployment. Yo lo dejé por defectoAñadir agentesLos agentes son programas diseñados para enviar información de los logs del host al Stack de Elastic. Para añadir un host y agregarle el agent vamos a instalar la ISO de windows en nuestro VMware o VirtualBox.Después de hacer una correcta instalación de windows en nuestra máquina virtual, seguimos con la instalación del agente.Paso ElasticNos aparecerá esta interfaz donde haremos clic en Management - FleetDespués, hacemos clic en Add agentCreamos una policy llamada WindowsLo dejamos en recommendedAquí copiamos el código para pegarlo en un powershell con privilegios en la máquina WindowsPaso WindowsEn nuestra máquina virtualizada iniciamos powershell como administrador.Creamos una carpeta nueva y ejecutamos el código copiado de Elastic con botón derechoUna vez finalice, en Elastic podremos ver que se ha completado correctamente.Instalación de SysmonSysmon es una utilidad que monitorea Windows de una forma la cual te provee de logs con información detallada sobre procesos, conexiones de red y más. Es uno de los mejores logs para investigar.Vamos a descargar Sysmon desde aquí y la configuración necesaria desde aquíUna vez descargados, iniciamos powershell como administrador y ejecutamos el siguiente código.\\Sysmon64.exe -accepteula -i .\\sysmonconfig-export.xmlPara ver que el servicio está corriendo correctamente, ejecutamos el siguiente códigoGet-Service | findstr 'Sysmon'Con esto hemos instalado Sysmon y nos hace falta poder enviarlo a ElasticInstalación de IntegracionesPara enviar todos los logs del agent de Windows, hay que instalar una integración a la política existente.Vamos a Management - Fleet - Agent Policy y hacemos clic en la política que creamos de WindowsClicamos en Add integrationBuscamos Windows, hacemos clic y lo añadimosDejamos todo como está y guardamosAhora podremos recopilar todos los logs de Sysmon de forma correcta y nos faltaría el EDR.Instalación del EDRUn EDR (Endpoint Detection and Response) es una solución de seguridad diseñada para detectar, investigar y responder ante posibles amenazas de los endpoints conectados. Las técnicas de detección de un EDR son avanzadas y además nos provee de alertas a nuestro SIEM.Para instalarlo hay que ir a integraciones y buscar Elastic DefendAñadimos Elastic DefendLo dejamos todo por defectoGuardamos y desplegamos los cambiosVerificación de la instalaciónBuscamos en Security - Manage - Endpoints que todo se haya producido correctamenteUna vez que nos aparezca nuestro host podremos: Aislar la máquina, ejecutar comandos con “Respond” para poder hacer de respuesta a incidentes (aunque no es la mejor opción) y ver todos los detalles del host.Añadir ReglasVamos a añadir todas las reglas que nos proporciona Elastic DefendEn Alerts hacemos clic en Manage RulesLas seleccionamos todas y las habilitamosUso del EDRDetección Doble extensiónPara ponerlo a prueba vamos a copiar el ejecutable de la calculadora y vamos a añadir de nombre calc.jpg para que haga de doble extensión y lo ejecutamos.Al iniciar la calculadora podemos ver que ha bloqueado la ejecución por tener doble extensión ya que es una técnica de Masquerading utilizada para engañar al usuario.Vamos al explorador de archivos y en vista marcamos Extensiones de nombre de archivoAhora podremos ver que realmente tenía doble extensión y estábamos intentando enmascarar la extensión real que era .exeEsta incidencia ha aparecido en Alertas de Security (se ejecutó dos veces)También si buscamos en Kibana calc.jpg nos aparece (Kibana se encuentra en Analytics - Discover)Detección RTLOPara probar otra técnica mas sofisticada hemos probado RTLO con esta herramienta https://github.com/BlackShell256/RTLOEsta técnica haría bypass al antivirus pero sería bloqueado por el EDR.Para más información de este tipo de técnicas de Masquerading visita: https://attack.mitre.org/techniques/T1036/" }, { "title": "Certified CyberDefender (CCD) - Review de Certificación y Exámen", "url": "/posts/certified-cyberdefender-review/", "categories": "Review, Certification", "tags": "CyberDefenders, CCD, Review, Certification", "date": "2023-06-06 09:30:00 +0200", "snippet": "Después de mucho esfuerzo y dedicación, he aprobado la CertifiedCyberDefender de la mano de CyberDefenders y completado todo su contenido y quería compartir mi experiencia.CyberDefenders es una plataforma de formación para especialistas de Blue Team, donde hay retos muy interesantes de todo tipo. La mayoría de ellos realistas y que ponen a prueba tus competencias.Lo que me gusta, es que están apartados de los típicos CTFs que hay que enviar una flag{}.Este entrenamiento está creado por profesionales con años en la materia y es preparado para gente que quiere ser Analista de SOC, Profesionales de DFIR y Threat HuntersPrerrequisitosLo primero de todo es que tienes que tener una buena base de redes, conceptos de seguridad, capacidad de resolución de problemas y un poco de base en el mundo pentesting o ciberseguridad.Contenido del Curso Security Operations (SecOps) Fundamentals Incident Response Perimeter Defense - Email Security Forensics Evidence Collection Disk Forensics Memory Forensics Network Forensics Threat Hunting and EmulationLección de RITA del CCDEl contenido es extenso, muy bien estructurado y explicativo ya que te da todo lo necesario para posteriormente desenvolverte bien en las labs que ponen a prueba tus conocimientos.Una de las cosas que más me gustó del contenido es la parte de Disk Forensics donde aprendí más de mi propio entorno Windows y con ello me hizo sentirme más cómodo.Para más detalles visita CyberDefenders CCD*Recuerda tomar notas para cuando llegue el exámen y descargar las CheatSheets que hay disponibles en el curso.LabsDado que hay una parte teórica, también debe haber una práctica.Hay 21 labs disponibles y te dan 120 horas para ellas (a día de hoy) de las cuales he consumido 56 horas en total. Tienes suficientes horas. Con este tiempo, me dio para volver a hacer las labs.Este contenido es mucho más difícil (cosa que se agradece) y probablemente algunas veces te frustrarás por no dar con la respuesta. Cuando pase esto, tienes el canal de discord donde te ayudarán con tus dudas y problemas.Después de finalizar todas las labs, te recomiendan labs adicionales para practicar más, que están disponibles en la parte de BlueYard de la misma plataforma.El siguiente paso sería el exámen pero una vez que tengas una buena base en el contenido del curso, te hayas hecho todas las labs, labs adicionales y sobre todo, entiendas lo que haces.Experiencia del exámenEn el exámen dispones de un máximo de 48 horas y te ponen a prueba con entornos reales que son todos casos independientes en áreas de Threat Hunting, Disk Forensics, Perimeter Defense, Memory Forensics y Network Forensics.Dada la duración del exámen, es recomendable que esos dos días los planees con anterioridad y que tengas un entorno tranquilo.En mi caso, a pesar de planearlo para el finde, no pude hacer el exámen porque no estaba disponible por mantenimiento y tuve que hacerlo una semana después.*Antes de darle a comenzar el examen, es muy importante leer las FAQ que hay a la hora de hacer el exámen. Una vez lo comencé por la mañana, me añadieron automáticamente en un canal privado de discord con mi nombre por si sucedía cualquier problema técnico.Fui resolviendo preguntas de Threat Hunting hasta que un momento me estanqué y decidí seguir con otra sección. Así lo hice cada vez que me estancaba para poder familiarizarme con todos los casos y las preguntas.Las horas se me pasaban rápidas y sentí que entré en un estado de flow donde solo estaba yo disfrutando del exámen. Y gracias a mover un poco las piernas y tomarme pausas, pude pensar con mejor claridad.Al final del día, completé la parte de Disk Forensics, Memory Forensics y Network Forensics entera y un poco de Threat Hunting.En el segundo día, aun tenía las dudas de si podría aprobarlo ya que era duro y me quedaban preguntas por responder pero al final del día pude hacer casi todo lo que me quedaba a excepción de tres preguntas.*Hay que tener en cuenta que el exámen está calificado por personas reales y se debe responder en base a las preguntas y dando todo tipo de detalles necesarios como si fuera un reporte de un incidente real.Una vez entregado, solo quedaba tomarse un descanso sin importar que aprobara o lo suspendiera.CertificadoDespués de tres días, este fue mi resultado del cual estoy muy orgulloso.Resultado del exámenCertificado CCDAprobando el exámen te dan una moneda física del CCD(Oro=&gt;85% o Plata), una insignia en el canal de discord y el certificado electrónico.Además, te felicitan por el canal público del discord CyberDefenders que te hace estar más contento por aprobar.ConclusiónEs una certificación muy recomendable y sus 499.99$ (en el momento de escribirlo) están muy bien, que incluso puedes recibir otro descuento si eres estudiante.La certificación se diferencia mucho por: Gran calidad de contenido Laboratorios desafiantes Buena comunidad Buen soporte Exámen muy realista y bien preparado“Defend Smarter, not Harder”" }, { "title": "Análisis de documentos maliciosos - MALDOCS", "url": "/posts/analyzing-maldocs/", "categories": "Tutorial, Malware", "tags": "Tutorial, MalDocs, BlueTeam, Malware", "date": "2023-04-17 11:00:00 +0200", "snippet": "Los documentos maliciosos tipo Word, Excel o incluso PDF se propagan la mayoría de ellos por email. Por lo que tener una buena medida de email security es esencial pero hay algunos archivos que se saltarán esas restricciones.En algún momento alguien te habrá enviado un documento muy sospechoso el cual te gustaría analizar. Para esos casos viene bien hacerlo no solo con el antivirus sino con otras herramientas.En este caso, vamos a analizar los documentos DOCM o DOTM que contienen Macros (La M de DOCM es de macros)Para poner un ejemplo practico, vamos a tomar este challenge de CyberDefendersDescargar DOCM MaliciosoLos primeros pasos a tener en cuenta son:1 - Poseer un laboratorio de Análisis de MalwarePara empezar siempre un Análisis de Malware, debes disponer de una máquina para ello. Puedes conseguir hacerte con la tuya aquí: Configurar laboratorios para Análisis de MalwareCon REMNUX podrás tener todas las herramientas necesarias.2 - Instalación de programas necesariosLibreOffice (Word, Excel, etc.)https://www.libreoffice.org/En el caso de que no instales REMNUX debes descargar estas herramientasOletoolsgit clone https://github.com/decalage2/oletools.gitOledumpwget https://raw.githubusercontent.com/DidierStevens/DidierStevensSuite/master/oledump.py3 - Herramientas online a tener en cuentaCyberChef para desofuscarAny.Run realiza un análisis dinámicoVirusTotal revisión en mas de 60 antivirusDespués de descargar el documento, procedemos a hacerle un análisis de metadatos con olemeta (también podríamos hacerlo con exiftool) y ver su hash para luego poder mandarlo any.run o virustotal con el comando md5sum sample.binPodemos observar que su nombre original es ‘Normal.dotm’, se ha editado 1 vez, la edición no ha durado ni 1 minuto, tiene 1 página y 3 palabras. Con esto podemos sospechar bastante.Ejecutamos oleid en el archivo para obtener más información y obtendremos que tiene Macros este DOTMPodríamos saltarnos estos pasos anteriores y analizar el documento en busca de todos los macros posibles pero no entenderíamos a qué nos enfrentamosUna vez sabemos que tiene macros, lanzamos oledumpAquí podemos ver que en el stream 13 es un macro ‘vba’ que tiene un tamaño de 1367 y se encuentra en ‘Macros/VBA/diakzouxchouz’Con el parametro ‘-s’ elegimos el stream que queremos seleccionar y ‘-v’ para hacer un vba decompression. En el stream 13 vemos que se utiliza la función document_open() que se ejecuta al abrir el archivo.Para ver todos los Macros de una vez podemos utilizar olevbaAquí nos muestra todos los Macros y su contenido. Como podemos ver, nos señala document_open() como algo importante a tener en cuenta.En la parte final nos da una descripción de todo lo que ha podido encontrar, como un base64.Ese base64 pertenece al ‘Macros/roubhaol/i09/o’ en el que vemos que se repite mucho una serie de caracteres.Después de encontrar el patrón lo copiamos todo y lo llevamos a CyberChefReemplazamos 2342772g3&amp;*gs7712ffvs626fq (si analizamos las macros podríamos saber que reemplaza este string), quitamos los null bytes, reemplazamos el string ‘powershell -e’ y obtenemos el base64. Con un poco de esfuerzo y borrando más, podemos ver como se comporta este malware. El malware descarga un archivo de estas páginas que renombra al directorio C:\\Users\\usuario\\337.exePara analizarlo en LibreOffice (deberías deshabilitar la ejecución de macros antes), vamos a ‘Tools’ y a ‘Edit Macros’Viendo las otras herramientas sabemos que son mejores pero aquí podríamos debuggearlo y ver formulariosSi hemos sacado el md5 del archivo y lo hemos buscado en any.run veremos que ese mismo script de powershell se habría ejecutado.Análisis en any.run" }, { "title": "Adquisición y análisis de memoria RAM en Windows", "url": "/posts/memory-acquisition-windows/", "categories": "Tutorial, Forensics", "tags": "Tutorial, Forensics, BlueTeam, Volatility, Windows", "date": "2023-02-12 21:00:00 +0100", "snippet": "La memoria volátil o memoria RAM, es una parte fundamental de las investigaciones forenses de los ordenadores.Contiene datos volátiles mientras el sistema operativo está en ejecución. La información almacenada en la memoria volátil pierde información de procesos en ejecución, conexiones de red abiertas, contraseñas y demás cuando se apaga el pc.Mimikatz es una herramienta de seguridad utilizada por hackers que se aprovecha de extraer información de autenticación de la memoria volátil. Al ser una herramienta tan peligrosa la mayoría de sistemas detectan esa amenaza.Algunos malwares utilizan herramientas del propio sistema operativo para saltarse restricciones como scripts en powershell o lolbins https://lolbas-project.github.ioComo todos esos procesos se quedan en memoria, es importante hacer una captura a la memoria para posteriormente hacer la investigación forense. Sin ella podemos perder información importante.Todo ello hace que la adquisición de memoria sea un paso esencial por el que debe empezar toda investigación forense.Comparativa de herramientas3 importantes variables hay que tener en cuenta a la hora de elegir una herramienta: RAM Footprint Cuánta memoria consume la herramienta al extraer RAM (ya que para obtener esta memoria se necesita memoria). Esto es importante, ya que la huella de la RAM equivale a la cantidad de pruebas potenciales que posiblemente se sobrescriban como parte inevitable del proceso. Modo Las herramientas de recopilación de RAM funcionan en Kernel-Mode o en User-Mode. El modo Kernel tiene la capacidad de recopilar más datos de la RAM que son inaccesibles, ya que está diseñado para eludir activamente la protección antidepuración y antidumping. Velocidad de extracción Rapidez con la que la herramienta copia la memoria RAM a través de una conexión USB 3.0. También es importante porque en cada momento que pasa la memoria puede cambiar o puede que el malware la limpie.Comparativa de las diferentes herramientas (Fuente)Dada la comparativa que vemos en la imagen diríamos que la mejor herramienta es DumpIt porque gana en absolutamente todo. Así que haremos una práctica que en este caso elegiremos DumpItVamos a descargarnos dumpIt desde la página de Magnet aquí (más actualizada) o bien desde aquíSHA256 del segundo linkLa idea es ejecutar esta o cualquier otra herramienta desde una unidad externa, como un USB y no instalarla. Ya que como hemos dicho, queremos dejar la menor huella posible y hacerlo rápido.También es importante no guardar el archivo de imagen en el sistema, sino en el USB o en un recurso compartido de red. Ya que de lo contrario, se sobrescribiría el espacio no asignado dentro del disco duro. La sobrescritura del espacio no asignado puede impedir recuperar el contenido de la memoria borrada que aún pueda estar accesible y ser problema en una adquisición forense del disco.Practica DumpItCrea una máquina virtual de Windows y ejecuta algunos procesos como powershell.Extracción WindowsUna vez que tengamos dumpIt en el USB y lo insertemos en un sistema Windows, lo ejecutamos con doble clic.Este sistema windows tiene 2GB de RAM que se guardarán en mi USB de 7GB de almacenamiento. A la hora de hacer la extracción de la imagen, hay que tener en cuenta la RAM del dispositivo y del USB. El archivo se guardará en la ruta ‘E:\\DESKTOP-4BLUE0H-20230212-182517.raw’ indicando el nombre del ordenador y fecha actual con formato yyyymmdd-hhmmssUna vez acabada la extracción aparecerá en nuestro USB. Comprobamos su hash.Copiado ImagenCopiamos la imagen en nuestro kali para proceder a analizar. Comprobamos de nuevo el hash para asegurarnos de que no ha habido ningún error en el momento de copiado.Descarga volatility3Descargamos volatility3 desde githubgit clone https://github.com/volatilityfoundation/volatility3.gitcd volatility3python vol.py -hEjecutamos el siguiente plugin, en el que podremos ver que en el momento de la captura está dumpIt ejecutándose desde el explorer:python vol.py -f tuImagen.raw windows.pstreeApartir de este momento puedes explorar que conexiones, procesos, archivos y demás se encontraban en el sistema en el momento de la captura.Cheatsheet de volatility3https://book.hacktricks.xyz/generic-methodologies-and-resources/basic-forensic-methodology/memory-dump-analysis/volatility-cheatsheet" }, { "title": "¿Cómo empezar en el Blue Team?", "url": "/posts/learning-blueteam/", "categories": "Tutorial, BlueTeam", "tags": "Tutorial, CTF, BlueTeam", "date": "2022-11-13 17:00:00 +0100", "snippet": "Una de las mejores formas de empezar en el mundo del Blue Team como en cualquier otro ámbito es practicar.Por ello, os voy a compartir las mejores páginas para darle caña a la parte defensiva :1.TryHackMeTryHackMe es una de las mejores plataformas para aprender desde un nivel principiante y también desde un nivel avanzado.Hay dos paths: Una de ciberdefensa y otra nueva para entrar al mundo del SOC Analyst.Cyber Defense:https://tryhackme.com/path/outline/blueteamSOC Level 1(Nuevo):https://tryhackme.com/path/outline/soclevel1Y en más detalle aquí tenemos un poco más del contenido que nos encontraremos:Esta página es la que más he utilizado y aprendes bastante en ella. Algunos de estos cursos requieren el VIP que cuesta $10/mes que merecen la pena pagarlo.Puntuación: ★★★★★2.LetsDefendLetsDefend es una plataforma que conocí hace relativamente poco y me ha encantado un montón porque trata de simular un entorno real de SOC con 15 alertas mensuales(versión gratuita), las cuales tienes que investigar y sacar conclusiones finales.Además, trae algunos cursos gratuitos para aprender tanto teóricamente como con alertas de SOC y un path a seguir.También ofrece unos challenges interesantes.El coste actual de la suscripción mensual es de unos $25 o $40 según el pack y no todos los cursos están disponibles, pero tiene un buen potencial de aprendizaje.Puntuación: ★★★★✰3.CyberDefendersCyberDefenders es la primera página que descubrí de CTFs de BlueTeam y me gustó porque son retos desafiantes y que aprendes mucho sobre ellos. Y hace poco sacaron una certificación que es la CCD centrándose más en la practica con el mundo real.Tiene retos de: Threat Intel, Incident response, Malware Analysis, Digital ForensicsTe dicen con que herramienta deberías hacer el reto y te ponen una serie de preguntas para valorar tu resolución.Tiene coste 0$ y hacer muchos de estos te sirven como demostración de tus habilidades y son un poco más avanzados.Puntuación: ★★★★★4.TCMSecurityTCMSecurity es una plataforma de aprendizaje a través de cursos, que desde mi punto de vista son muy buenos.Para el Blue Team hay un curso de Malware Analysis que me impresionó con lo que aprendes, como analizar el WannaCry. En YouTube tienes las 6 primeras horas del curso gratis https://www.youtube.com/watch?v=qA0YcYMRWyIY hay uno más de forense y de análisis móvil.El único curso que hay gratis es una formación para su certificación PNPT pero es más de pentesting.El coste es un poco elevado pero si los cursos los compras en ofertas, te los recomiendo mucho.Puntuación: ★★★✰✰5.Blue Team Labs OnlineBlue Team Labs Online está impulsada por Security Blue Team (que oferta la certificación BTL1 centrada en Blue Team) y dentro hay labs de varias categorías de Blue Team como su nombre especifica. También tiene otra sección que son investigaciones la cual la mayoría son para el VIP:No he utilizado mucho la página pero se que tiene buena reputación ya que viene de los que hicieron la BTL1. Tienen pocos retos y hay muy pocos que requieran VIP y cuesta unos $17.Puntuación: ★★★★✰6.CybraryCybrary es una plataforma en la que tiene una variedad de cursos que puedes ver tanto con su página web como con su aplicación móvil. En lo que destacan mucho son con los cursos centrados en el MITRE ATT&amp;CK Framework. También tiene un path de SOC Analyst aunque pocos cursos son gratis.Como vemos tenemos varios cursos de MITRE y además todos gratisPara darnos una base de MITRE empezaríamos con el curso de FundamentalsSi quieres aprender sobre el MITRE ATT&amp;CK esta plataforma es la idealPara el resto, algún curso puede estar bien pero no es muy viable a largo plazo porque su mensualidad cuesta $59.Puntuación: ★★★✰✰BonusHackTheBoxHackTheBox es una plataforma más para pentesting pero tienen una sección que puedes practicar para Blue Team como Reversing y ForensicsRootMeRoot Me también ofrece retos como Forensics y de Network¡Espero que podáis aprender mucho en estas plataformas!" }, { "title": "Configurar laboratorios para Análisis de Malware", "url": "/posts/malware-analysis-lab/", "categories": "Tutorial, Malware", "tags": "Malware, Tutorial, Windows, Linux, VMware", "date": "2022-09-25 21:00:00 +0200", "snippet": "Para analizar un malware es necesario tener un entorno seguro con el que trabajar. Existen malwares tanto para Windows como Linux por lo que prepararemos ambos entornos. Para conseguirlo, hay que seguir a rajatabla los siguientes pasos:1- Instalar una aplicación de virtualizaciónPara estar seguros a la hora de tratar con malwares, es imprescindible utilizar un software para virtualizar el entorno.Hay muchos softwares distintos pero los más populares son:Oracle VM VirtualBox que es gratuito y de código abierto.VMware Workstation 16 Pro que es mucho más ágil y requiere licencia(tienes 30 días de prueba).Si vas a utilizar VMware deberás utilizar la versión Pro como la indicada arriba para poder realizar snapshots y NO la versión gratuita de VMware Player.2- Descargar la ISO de Windows y el OVA de Linux e instalarlaLa ISO que debemos descargar es la de Windows 10 Enterprise.https://www.microsoft.com/en-us/evalcenter/download-windows-10-enterpriseNos descargamos la de 64 bits en el idioma que quieras, en mi caso elegí la de “English (United States)” para que sea más fácil a la hora de buscar por internet, si tenemos alguna duda.Para instalarla añadimos una nueva maquina virtual en VMware, añadimos la ISO, le damos un espacio de mínimo 50GB y seguimos el procedimiento de una instalación de Windows.Para Linux descargaremos REMnuxhttps://docs.remnux.org/install-distro/get-virtual-applianceDescargamos la General OVA si estamos en VMware y la VirtualBox OVA si estamos utilizando VirtualBox.En la instalación tendremos que importar el OVA que hemos descargado y lo tendríamos.3- Actualiza e instala las herramientas de análisis de malwareLo primero de todo, en la máquina de Windows descargamos Chrome con Microsoft Edge. Después de haber hecho eso, añadimos una snapshot para tenerla de una fresca instalación sin nada más.Ahora para instalar FlareVM abriremos Powershell como Administrador, escribimos Set-ExecutionPolicy Unrestricted y seleccionamos Yes to All. Entonces escribimoswget https://github.com/fireeye/flare-vm/raw/master/install.ps1 -UseBasicParsing -outfile C:\\Users\\\"NOMBREUSUARIO\"\\Desktop\\install.ps1Vamos al escritorio y lo ejecutamos y esperamos como unos 40 minutos para que termine. Cuando termine, reiniciamos y ya tendríamos la herramienta preparada.También deberíamos descargarnos sysinternalsuite ya que no viene todo con el FlareVM https://learn.microsoft.com/es-es/sysinternals/downloads/sysinternals-suite y también descargaremos pestudio https://www.winitor.com/downloadTenemos que hacerle una snapshot a esta instalación por si acaso hubiera algún problema.4- Aislar la máquina virtual y crea una snapshotPara acabar de terminar de asegurar nuestros laboratorios y que el malware no se escape, vamos a aislar la máquina en otra red.Lo primero, desactivamos las carpetas compartidas en: (VMware) Settings &gt; Options &gt; Shared Folders y click en Disabled.Esta máquina deberá estar en una red Host-Only que significa que:X No tendrá acceso a Internet X No tiene conexión con los demás dispositivos de la redX No tendrá conexión con el sistema nativoEn VMware vamos a Edit y seleccionamos “Virtual Network Editor” y creamos una nueva network con esta configuración:En las propiedades de la lab, en NetworkAdapter le añadimos la red que acabamos de crear5- Analizar MalwaresEn este repositorio tienes disponible algunos malwares disponibles para ver como funcionan:Live Malware RepositoryAlgunas de las herramientas que me gustan para analizar malwares son: PeStudio (análisis estático windows) GHidra (desensamblador linux) Cutter (desensamblador linux, windows y mac) Procmon (monitor de procesos para windows) Wireshark (análisis de red) INetSim (simulador de servicios de internet)Aprender másPara aprender más sobre Malware Analysis puedes echarle un vistazo a este curso que me sirvió de gran utilidadhttps://academy.tcm-sec.com/p/practical-malware-analysis-triage" }, { "title": "Eli Forensics Challenge | CyberDefenders", "url": "/posts/eli-challenge-writeup/", "categories": "CTF, Forensics", "tags": "CyberDefenders, CTF, Forensics, Chromebook, Takeout", "date": "2022-08-21 18:00:00 +0200", "snippet": "https://cyberdefenders.org/blueteam-ctf-challenges/98Detalles del reto:Un entusiasta del lacrosse a la caza de un delicioso sándwich de pollo.Puntos: 255Obtenemos un zip que al descomprimirlo nos dan 2 comprimidos: ‘2021 CTF - Chromebook.tgz’ Imagen del chromebook ‘2021 CTF - Takeout.zip’ Datos extraídos de la cuenta de google https://takeout.google.com/* ¡Atención! Hay dos formas de hacer la sala. Puedes utilizar un software (cleapp,magnet axiom,etc.) para que te liste toda la información, lo puedes hacer manualmente o de ambas formas *Recursos: https://github.com/markmckinnon/cLeappPreguntas1-The folder to store all your data in - How many files are in Eli’s downloads directory?Si vamos al directorio ./2021 CTF - Chromebook/decrypted/mount/user/Downloads vemos que nos salen 6 archivos.(Con la aplicación CLEAPP solo nos muestra 2 descargas ya que solo 2 fueron realmente descargadas de una pagina web)2-Smile for the camera - What is the MD5 hash of the user’s profile photo?La foto de perfil del usuario se encuentra en ./2021 CTF - Chromebook/decrypted/mount/user/Accounts/Avatar ImagesEl hash de la imagen es 5ddd4fe0041839deb0a4b0252002127b3-Road Trip! - What city was Eli’s destination in?Volviendo a la carpeta de Downloads tenemos una screenshot de un viaje en Google Maps.Podemos ver que se dirige a Chick-fil-A a la ciudad de Plattsburgh en el estado de Nueva York.4-Promise Me - How many promises does Wickr make?En la misma carpeta hay un pdf de Wickr-Customer-Security-Promises y en la página 3 nos cuentan las 9 promesas que hacen.5-Key-ty Cat - What are the last five characters of the key for the Tabby Cat extension?Buscamos el nombre de la extensión de Chrome en google para encontrar el identificador.Una vez con el identificador podemos ir a la carpeta ./2021 CTF - Chromebook/decrypted/mount/user/Extensions/mefhakmgclhhfbdadeojlkbllmecialg, hacemos un cat al archivo manifest.json y obtenemos la key❯ cat manifest.json { \"author\": \"Leslie Zacharkow\", \"chrome_url_overrides\": { \"newtab\": \"public/index.html\" }, \"description\": \"A new friend in every tab.\", \"icons\": { \"128\": \"icon128.png\" }, \"key\": \"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAjA9ElNuqHGIuDyrztUxn0nV1CLRgjSHEKw1zfhzE/6OdWd3teRV9wq4EukIX8UKf96fhS2WsLVnTuRmF7mQuqeAIxOkSvFm4Set3YRQ5994NA8Y9un1ZGhPtjFnpoLo1pEA5PPly5/BX2y3Ci2Rb0C3wp8NdeXud4r6BKEzhPdWmkwIS+YbTWhOBR1IbP/sF6+l8EdG/Ks881p8LO0J3qepmhNDA/LjVWzJq5ARmIYeT3TnvR/qRGTY9UXfUvg3gcUWV2LBBpeil8t6Np0PVYvG44zOBhKUnYSVE6gAcXENLTJJABgRgKT1K1kDYl1N8LJZf/S/9Ix1P+wItoEinTwIDAQAB\", \"manifest_version\": 2, \"name\": \"Tabby Cat\", \"offline_enabled\": true, \"permissions\": [ \"storage\" ], \"update_url\": \"https://clients2.google.com/service/update2/crx\", \"version\": \"2.0.0\"}Los últimos 5 caracteres son: DAQAB6-Time to jam out - How many songs does Eli have downloaded?2 canciones en el path ./2021 CTF - Chromebook/decrypted/mount/user/MyFiles/Music7-Autofill, roll out - Which word was Autofilled the most?Para hacernos el trabajo mas fácil a partir de aquí vamos a ayudarnos de CLEAPP.Con el reporte de CLEAPP vemos que el campo que mas se autocompletó fue: emailEsta misma información podríamos haberla sacado del archivo ‘Web Data’, que es una base de datos sqlite con sqlitebrowser8-Dress for success - What is this bird’s image’s logical size in bytes?Aquí no entendía a que se refería con el pájaro y recordé que había una descarga de tux.❯ du -b tux.png 46791 tux.png9-It’s about the journey, not the destination - How many miles would the trip have been if Eli had taken a long way?En la screenshot de google de descargas tenemos la respuesta: 81.2 millas10-Repeat customer - What was Eli’s top visited site?Si nos dirigimos a Chromebook Top Sites, podemos ver que \"https://protonmail.com/\" tiene el rango más alto siendo el número 011-Vroom Vroom, What is the name of the car-related theme?Esta pregunta no la entendí del todo. Hasta que busqué la palabra “theme” y encontré un archivo en ”./Extensions/dkkklbgbfaeockpgbkleblklmcjdbnbj/1_0/images/theme_frame.png que mostraba un Lamborghini RojoSi leemos el manifest.json de la extensión nos da la respuesta: Lamborghini Cherry12-You got mail - How many emails were received from notification@service.tiktok.com?Aquí empezamos con la carpeta de Takeout.Vamos a ./Takeout/Mail y tenemos todos los emails en un mbox. Para leerlos fácilmente, los he importado al Feed en la aplicación de ThunderBird y en ajustes he cambiado el destino del almacenamiento de mensajes a la carpeta Mail. La respuesta son 6 emails13-Hungry for directions - Where did the user request directions to on Mar 4, 2021, at 4:15:18 AM EDT(Abriendo la carpeta de Takeout en el navegador se nos hace más fácil movernos por los archivos).Encontramos esa dirección pedida en ./My Activity/Maps/MyActivity.html Chick-fil-A14-Who defines essential? - What was searched on Mar 4, 2021, at 4:09:35 AM EDTLo podemos encontrar en ./My Activity/Search/MyActivity.htmlis travelling to get chicken essential travel15-I got three subscribers, and counting - How many YouYube channels is the user subscribed to?En el json que encontramos en ./YouTube and YouTube Music/subscriptions/subscriptions.json obtenemos 0[]16-Time flies when you’re watching YT - What date was the first YouTube video the user watched uploaded?Los videos vistos se encuentran en ./YouTube and YouTube Music/history/watch-history.html y el primer video fue visto el Feb 3, 2021 y era de Lacrosse pero lo que realmente pregunta es cuando fue subido ese video visto. El video es https://www.youtube.com/watch?v=R0UhA3fwz_g y se subió el 27-01-202117-How much? - What is the price of the belt?Aquí se entiende que el usuario ha pagado o buscado un cinturón y así es, lo ha buscado. En ./My Activity/Chrome/MyActivity.htmlHacemos clic en la página web y nos aparece como Agotado y no tenemos precio alguno.Sin embargo, podemos ver en el html el precio original que aparecía antes que es 98.5¡Gracias por haber leído mi primer writeup!" } ]
