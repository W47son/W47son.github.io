<!DOCTYPE html><html lang="es-ES" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Análisis y reporte del chrome stealer - ChromeUpdater.exe" /><meta property="og:locale" content="es_ES" /><meta name="description" content="Analizar los propios malwares personalizados es vital para saber detectarlos posteriormente. Por ello, he creado un malware stealer de credenciales en Golang." /><meta property="og:description" content="Analizar los propios malwares personalizados es vital para saber detectarlos posteriormente. Por ello, he creado un malware stealer de credenciales en Golang." /><link rel="canonical" href="https://w47son.github.io/posts/analisis-reporte-malware-chrome-stealer/" /><meta property="og:url" content="https://w47son.github.io/posts/analisis-reporte-malware-chrome-stealer/" /><meta property="og:site_name" content="W4tson" /><meta property="og:image" content="https://w47son.github.io/assets/img/commons/chrome-updater/0Chrome.png" /><meta property="og:image:height" content="300" /><meta property="og:image:width" content="600" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-08-21T15:00:00+02:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://w47son.github.io/assets/img/commons/chrome-updater/0Chrome.png" /><meta property="twitter:title" content="Análisis y reporte del chrome stealer - ChromeUpdater.exe" /><meta name="twitter:site" content="@W4tson_Blue" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-08-21T16:55:10+02:00","datePublished":"2023-08-21T15:00:00+02:00","description":"Analizar los propios malwares personalizados es vital para saber detectarlos posteriormente. Por ello, he creado un malware stealer de credenciales en Golang.","headline":"Análisis y reporte del chrome stealer - ChromeUpdater.exe","image":{"width":600,"height":300,"url":"https://w47son.github.io/assets/img/commons/chrome-updater/0Chrome.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://w47son.github.io/posts/analisis-reporte-malware-chrome-stealer/"},"url":"https://w47son.github.io/posts/analisis-reporte-malware-chrome-stealer/"}</script><title>Análisis y reporte del chrome stealer - ChromeUpdater.exe | W4tson</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="W4tson"><meta name="application-name" content="W4tson"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://avatars.githubusercontent.com/u/54062322" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">W4tson</a></div><div class="site-subtitle font-italic">Blue Team | Certified Cyberdefender | CSIO</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>INICIO</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORÍAS</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>ETIQUETAS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVO</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ACERCA DE</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/w47son" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/W4tson_Blue" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="https://tryhackme.com/p/W4tson" aria-label="tryhackme" target="_blank" rel="noopener"> <i class="fa fa-cloud"></i> </a> <a href="https://cyberdefenders.org/profile/W4tson" aria-label="cyberdefenders" target="_blank" rel="noopener"> <i class="fa fa-user-secret"></i> </a> <a href="https://www.linkedin.com/in/juan-jose-manuel-sanchez/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Inicio </a> </span> <span>Análisis y reporte del chrome stealer - ChromeUpdater.exe</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Entrada</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Buscar..."> </span> <span id="search-cancel" >Cancelar</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Análisis y reporte del chrome stealer - ChromeUpdater.exe</h1><div class="post-meta text-muted"> <span> Publicado <em class="" data-ts="1692622800" data-df="YYYY-MM-DD" data-toggle="tooltip" data-placement="bottom"> 2023-08-21 </em> </span> <span> Actualizado <em class="" data-ts="1692629710" data-df="YYYY-MM-DD" data-toggle="tooltip" data-placement="bottom"> 2023-08-21 </em> </span><div class="mt-3 mb-3"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 600 300'%3E%3C/svg%3E" data-src="/assets/img/commons/chrome-updater/0Chrome.png" class="preview-img bg" alt="Preview Image" width="600" height="300" data-proofer-ignore></div><div class="d-flex justify-content-between"> <span> Por <em> <a href="https://github.com/w47son">W4tson</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="935 palabras"> <em>5 min</em> de lectura</span></div></div></div><div class="post-content"><p>Analizar los propios <strong>malwares personalizados</strong> es vital para <strong>saber detectarlos</strong> posteriormente. Por ello, he creado un <strong>malware stealer de credenciales en Golang</strong>.</p><p>Toda la infraestructura está creada y ejecutada de forma <em>local</em>, por lo que no sale fuera de la red.</p><p><strong>OffensiveGolang</strong> es uno de los uno de los repositorios que me ha facilitado la programación como el desarrollo del exfiltrado de datos, para crearlo. Muy recomendable.</p><p><a href="https://github.com/MrTuxx/OffensiveGolang/" target="_blank">https://github.com/MrTuxx/OffensiveGolang/tree/main</a></p><p><br /></p><p>Para <strong>ofuscar el malware</strong> he utilizado esta herramienta que es la cual luego un simple comando <em>strings</em> no puede encontrar mucho y el <strong>análisis es más complicado y duradero</strong>.<br /> Con garble utilicé también una <em>semilla de aleatoriedad de ofuscación</em>.</p><p><a href="https://github.com/burrowers/garble" target="_blank">https://github.com/burrowers/garble</a></p><p><br /></p><p>Para la <strong>recolección</strong> de todos estos <strong>archivos exfiltrados</strong>, los recibí en un <strong>Kali Linux</strong> donde tenía levantado un <strong>Flask app.</strong></p><p>El malware <strong>no es detectado</strong> por el <strong>antivirus</strong> windows defender ya que es desconocido y no puede basarse en los signatures y la detección estática es bypasseada.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 550 550'%3E%3C/svg%3E" data-src="/assets/img/commons/chrome-updater/defender.png" alt="Defender" width="550" height="550" class="center-image" data-proofer-ignore></p><p>A continuación, voy a escribir un informe donde podemos ver el funcionamiento del malware:</p><hr /><h2 id="resumen-ejecutivo"><span class="mr-2">Resumen ejecutivo</span><a href="#resumen-ejecutivo" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>ChromeUpdater es un stealer en busca de exfiltrar artefactos de Google Chrome como por ejemplo: contraseñas y cookies. El malware encripta los archivos en AES y los exfiltra a una IP privada.</p><p>El malware está programado en Golang para Windows.</p><p><strong>Los primeros indicadores son:</strong></p><ul><li>Al iniciarlo solo se muestra en la barra de tareas<li>Esta aplicación solo dura milisegundos y se cierra<li>Cuando se cierra, se borra así mismo</ul><h2 id="resumen-técnico-de-alto-nivel"><span class="mr-2">Resumen técnico de alto nivel</span><a href="#resumen-técnico-de-alto-nivel" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Lo primero que hace el stealer es una busqueda de los siguientes archivos del path de ‘/AppData/Local/Google/Chrome/User Data’:</p><ul><li>Cookies<li>History<li>Web Data<li>Bookmarks<li>Login Data<li>Local State</ul><p>Después de leer los archivos, los encripta con una clave “01234567890abcdef” AES.</p><p>Hace una conexión con <code class="language-plaintext highlighter-rouge">httx://10.10.10.6:8080/endpoint</code> y envia los archivos a través de un método POST en forma de JSON (clave valor) y una vez finalizado, procede a borrarse a si mismo con un <code class="language-plaintext highlighter-rouge">cmd.exe /C del</code>.</p><h3 id="composición-de-malware"><span class="mr-2">Composición de malware</span><a href="#composición-de-malware" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>chromeUpdater.exe
SHA256 Hash:
FF6AFE9A7FF8D8C451CCBD3C5A0F473025D36074173A027B39FEECE45E78DA63
MD5 Hash:
0194AF976819E40CC63AD795D1F5CACE
</pre></table></code></div></div><h3 id="análisis-estático"><span class="mr-2">Análisis estático</span><a href="#análisis-estático" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Este malware no ofrece ningún tipo de <strong>“Time Date Stamp”</strong> en PEView</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 550 550'%3E%3C/svg%3E" data-src="/assets/img/commons/chrome-updater/1Chrome.png" alt="PEView" width="550" height="550" class="center-image" data-proofer-ignore></p><p>En las propiedades del ejecutable <strong>no encontramos</strong> alguna <strong>descripción</strong> ni <strong>versión</strong> ni <strong>nombre</strong> ni tampoco alguna <strong>firma digital</strong>.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 550 450'%3E%3C/svg%3E" data-src="/assets/img/commons/chrome-updater/2Chrome.png" alt="Propiedades" width="550" height="450" class="center-image" data-proofer-ignore></p><p>Como vemos ahora y veremos después, el lenguaje es <strong>Golang</strong> y está escrito para <strong>Windows</strong>.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 550 550'%3E%3C/svg%3E" data-src="/assets/img/commons/chrome-updater/3Chrome.png" alt="Lenguaje" width="550" height="550" class="center-image" data-proofer-ignore></p><p>Llevando el archivo a PEStudio, <strong>confirmamos</strong> que no hay <strong>ningún compiler-stamp ni firma</strong>, ni otro tipo de información</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 850 850'%3E%3C/svg%3E" data-src="/assets/img/commons/chrome-updater/4Chrome.png" alt="PEStudio" width="850" height="850" class="center-image" data-proofer-ignore></p><p>Algunas de las API a las que llama son para tratar hilos y es por eso que parecen del tipo Process Injection pero no hay más con “flag” interesantes</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 750 750'%3E%3C/svg%3E" data-src="/assets/img/commons/chrome-updater/5Chrome.png" alt="API" width="750" height="750" class="center-image" data-proofer-ignore></p><p>Extrayendo los <strong>strings</strong> a un documento vemos que está escrito en Golang por la terminación <strong>“.go”</strong> en muchos de los strings que hay y podemos ver el comportamiento en base a ello como <strong>syscall_windows.go</strong>, que hará llamadas al sistema que permiten a las aplicaciones interactuar con funciones de bajo nivel.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 350 350'%3E%3C/svg%3E" data-src="/assets/img/commons/chrome-updater/6Chrome.png" alt="Strings" width="350" height="350" class="center-image" data-proofer-ignore></p><p>Pasando el archivo de strings por <a href="https://github.com/w47son/MalAPIReader" target="_blank"><strong>malapi.py</strong></a> podemos ver que utiliza API para <strong>enumerar el directorio</strong>.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 550 550'%3E%3C/svg%3E" data-src="/assets/img/commons/chrome-updater/7Chrome.png" alt="Enumerar" width="550" height="550" class="center-image" data-proofer-ignore></p><p>Vemos que utiliza API para <strong>utilizar Internet</strong>, por lo que enviará o recibirá algo.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 550 550'%3E%3C/svg%3E" data-src="/assets/img/commons/chrome-updater/8Chrome.png" alt="Internet" width="550" height="550" class="center-image" data-proofer-ignore></p><p>También utiliza API helper para <strong>crear o abrir un archivo</strong>.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 550 550'%3E%3C/svg%3E" data-src="/assets/img/commons/chrome-updater/9Chrome.png" alt="Archivos" width="550" height="550" class="center-image" data-proofer-ignore></p><p>Extrayendo las cadenas a través del comando “strings” no dejó más que los imports que hemos visto y que está escrito en golang.</p><p><br /></p><p>Utilizando <strong>floss</strong> podemos extraer los strings ofuscados de una forma más avanzada. Debido a la ofuscación, el proceso tarda un rato.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 550 550'%3E%3C/svg%3E" data-src="/assets/img/commons/chrome-updater/10Chrome.png" alt="Floss" width="550" height="550" class="center-image" data-proofer-ignore></p><p>Nos devuelve que hay <strong>160.000 strings estáticas</strong> y de las <strong>tight strings</strong> que son descodificadas en la pila, obtenemos que es probable que acceda a los <em>Bookmarks de Google Chrome</em> y al archivo <em>Local State</em> donde reside la llave de encriptado.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 550 550'%3E%3C/svg%3E" data-src="/assets/img/commons/chrome-updater/11Chrome.png" alt="TightStrings" width="550" height="550" class="center-image" data-proofer-ignore></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 550 550'%3E%3C/svg%3E" data-src="/assets/img/commons/chrome-updater/12Chrome.png" alt="Strings" width="550" height="550" class="center-image" data-proofer-ignore></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>C:/Users/
/AppData/Local/Google/Chrome/User Data/Default/BookmarksjW
/AppData/Local/Google/Chrome/User Data/Local State
http://10.10.10.6:8080/endpointO[
0123456789abcdef<span class="k">*</span>Af

crypto/cipher: input not full blocks
crypto/aes: invalid key size
</pre></table></code></div></div><p>También parece que accederá a un endpoint llamado endpoint y esa cadena en hexadecimal encriptará los archivos.</p><h3 id="análisis-dinámico"><span class="mr-2">Análisis dinámico</span><a href="#análisis-dinámico" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Teniendo en mente que <strong>accede a archivos</strong> y son de <strong>Chrome</strong>, podemos filtrar por <strong>ReadFile</strong>.</p><p>Al ejecutar el programa vemos que ha accedido a todos esos archivos de Chrome</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 850 850'%3E%3C/svg%3E" data-src="/assets/img/commons/chrome-updater/13Chrome.png" alt="ReadFile" width="850" height="850" class="center-image" data-proofer-ignore></p><p>Posterior a ello, vemos que <strong>hubo una conexión</strong> al puerto <strong>8080</strong> de la <strong>10.10.10.6</strong> y <strong>envíos de información notables</strong>.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 550 550'%3E%3C/svg%3E" data-src="/assets/img/commons/chrome-updater/14Chrome.png" alt="Conexion" width="550" height="550" class="center-image" data-proofer-ignore></p><p>Al analizarlo en <strong>Wireshark</strong> vemos que hubo un <strong>POST</strong> a <strong>/endpoint</strong> de menos de 1 MB y en formato JSON</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 850 850'%3E%3C/svg%3E" data-src="/assets/img/commons/chrome-updater/15Chrome.png" alt="Wireshark" width="850" height="850" class="center-image" data-proofer-ignore></p><p>Utiliza un <strong>UserAgent genérico</strong> con un authorization custom con el nombre de <em>W4tson</em> y un <em>Issued Time de Sat 15 July 2023 08:30:32 UTC</em></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 750 550'%3E%3C/svg%3E" data-src="/assets/img/commons/chrome-updater/16Chrome.png" alt="UserAgent" width="750" height="550" class="center-image" data-proofer-ignore></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 750 550'%3E%3C/svg%3E" data-src="/assets/img/commons/chrome-updater/17Chrome.png" alt="Cyberchef" width="750" height="550" class="center-image" data-proofer-ignore></p><p>Tratando de decodificar la primera clave del JSON, vemos que no funciona.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 550 550'%3E%3C/svg%3E" data-src="/assets/img/commons/chrome-updater/18Chrome.png" alt="Cyberchef" width="550" height="550" class="center-image" data-proofer-ignore></p><p>Asumimos que se utilizó el <strong>cifrado AES</strong> encontrado en los <em>strings para cifrar este contenido</em>, por lo que utilizando el string encontrado <strong>“0123456789abcdef”</strong> podemos descifrar que el texto encriptado era <strong>“w4tsonCookies”</strong> y el <strong>valor clave es el contenido del archivo</strong>.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 350 350'%3E%3C/svg%3E" data-src="/assets/img/commons/chrome-updater/19Chrome.png" alt="AesDecrypt" width="350" height="350" class="center-image" data-proofer-ignore></p><p><br /></p><p>En <strong>Sysmon</strong> se observa que no hay ningún tipo de información del archivo a la hora de su ejecución.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 850 850'%3E%3C/svg%3E" data-src="/assets/img/commons/chrome-updater/20Chrome.png" alt="Sysmon1" width="850" height="850" class="center-image" data-proofer-ignore></p><p>El <strong>ParentImage</strong> de este <strong>cmd.exe / c del</strong> es el mismo chromeUpdater de <strong>eliminándose a sí mismo después de ejecutarse</strong>.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 550 550'%3E%3C/svg%3E" data-src="/assets/img/commons/chrome-updater/21Chrome.png" alt="ParentImage" width="550" height="550" class="center-image" data-proofer-ignore></p><p><em>El event id 26 registra la eliminación del ejecutable.</em></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 550 550'%3E%3C/svg%3E" data-src="/assets/img/commons/chrome-updater/22Chrome.png" alt="Captura" width="550" height="550" class="center-image" data-proofer-ignore></p><p>Vemos que registró la <strong>IP y el puerto de destino</strong> al que se conectó.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 550 550'%3E%3C/svg%3E" data-src="/assets/img/commons/chrome-updater/23Chrome.png" alt="Captura" width="550" height="550" class="center-image" data-proofer-ignore></p><p><strong>Detección</strong></p><p><strong>Por defecto</strong>, Windows <strong>no registra el acceso a archivos/carpetas</strong> (objetos), <strong>habilitamos</strong> la <strong>auditoría de objetos</strong> y supervisamos el archivo Local State.</p><p>Después de su ejecución, podemos ver que el proceso <strong>chromeUpdater accedió al archivo</strong>.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 850 850'%3E%3C/svg%3E" data-src="/assets/img/commons/chrome-updater/24Chrome.png" alt="Captura" width="850" height="850" class="center-image" data-proofer-ignore></p><p><strong>Mitigación</strong></p><p>Con todos estos archivos exfiltrados, el <strong>atacante</strong> puede acceder a <strong>todas las contraseñas</strong> del navegador <strong>excepto</strong> si tienes guardadas tus contraseñas en un gestor de contraseñas como <strong>KeePass</strong>.</p><p>También podrías utilizar <strong>Firefox</strong> y <strong>guardar tus contraseñas</strong> ahí, ya que te ofrece ponerle una <strong>master password</strong>.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/malware-analysis/'>Malware Analysis</a>, <a href='/categories/stealer/'>Stealer</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/malware/" class="post-tag no-text-decoration" >Malware</a> <a href="/tags/stealer/" class="post-tag no-text-decoration" >Stealer</a> <a href="/tags/golang/" class="post-tag no-text-decoration" >Golang</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> Esta entrada está licenciada bajo <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> por el autor.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Compartir</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=An%C3%A1lisis+y+reporte+del+chrome+stealer+-+ChromeUpdater.exe+-+W4tson&url=https%3A%2F%2Fw47son.github.io%2Fposts%2Fanalisis-reporte-malware-chrome-stealer%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fw47son.github.io%2Fposts%2Fanalisis-reporte-malware-chrome-stealer%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fw47son.github.io%2Fposts%2Fanalisis-reporte-malware-chrome-stealer%2F&text=An%C3%A1lisis+y+reporte+del+chrome+stealer+-+ChromeUpdater.exe+-+W4tson" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copiar enlace" data-title-succeed="¡Enlace copiado!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Actualizado recientemente</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/analisis-reporte-malware-chrome-stealer/">Análisis y reporte del chrome stealer - ChromeUpdater.exe</a><li><a href="/posts/certified-cyberdefender-review/">Certified CyberDefender (CCD) - Review de Certificación y Exámen</a><li><a href="/posts/como-montar-gratis-un-siem-edr-cloud/">Como montar un SIEM y EDR en Elastic Cloud GRATIS</a><li><a href="/posts/learning-blueteam/">¿Cómo empezar en el Blue Team?</a><li><a href="/posts/eli-challenge-writeup/">Eli Forensics Challenge | CyberDefenders</a></ul></div><div id="access-tags"><div class="panel-heading">Etiquetas populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/tutorial/">Tutorial</a> <a class="post-tag" href="/tags/blueteam/">BlueTeam</a> <a class="post-tag" href="/tags/malware/">Malware</a> <a class="post-tag" href="/tags/ctf/">CTF</a> <a class="post-tag" href="/tags/cyberdefenders/">CyberDefenders</a> <a class="post-tag" href="/tags/forensics/">Forensics</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/ccd/">CCD</a> <a class="post-tag" href="/tags/certification/">Certification</a> <a class="post-tag" href="/tags/chromebook/">Chromebook</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contenido</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Lecturas adicionales</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/malware-analysis-lab/"><div class="card-body"> <em class="small" data-ts="1664132400" data-df="YYYY-MM-DD" > 2022-09-25 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Configurar laboratorios para Análisis de Malware</h3><div class="text-muted small"><p> Para analizar un malware es necesario tener un entorno seguro con el que trabajar. Existen malwares tanto para Windows como Linux por lo que prepararemos ambos entornos. Para conseguirlo, hay que s...</p></div></div></a></div><div class="card"> <a href="/posts/analyzing-maldocs/"><div class="card-body"> <em class="small" data-ts="1681722000" data-df="YYYY-MM-DD" > 2023-04-17 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Análisis de documentos maliciosos - MALDOCS</h3><div class="text-muted small"><p> Los documentos maliciosos tipo Word, Excel o incluso PDF se propagan la mayoría de ellos por email. Por lo que tener una buena medida de email security es esencial pero hay algunos archivos que se ...</p></div></div></a></div><div class="card"> <a href="/posts/como-montar-gratis-un-siem-edr-cloud/"><div class="card-body"> <em class="small" data-ts="1686754800" data-df="YYYY-MM-DD" > 2023-06-14 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Como montar un SIEM y EDR en Elastic Cloud GRATIS</h3><div class="text-muted small"><p> Vamos a aprender a como montar un SIEM con Elastic en Cloud con su EDR activado y además ponerlo a prueba en una máquina Windows virtual. ¿Qué es un SIEM? Un SIEM (Security Information and Event ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/como-montar-gratis-un-siem-edr-cloud/" class="btn btn-outline-primary" prompt="Anterior"><p>Como montar un SIEM y EDR en Elastic Cloud GRATIS</p></a><div class="btn btn-outline-primary disabled" prompt="Nuevo"><p>-</p></div></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/w47son">W4tson</a>. <span data-toggle="tooltip" data-placement="top" title="Salvo que se indique explícitamente, las entradas de este blog están licenciadas bajo la Creative Commons Attribution 4.0 International (CC BY 4.0) License por el autor.">Algunos derechos reservados.</span></p></div><div class="footer-right"><p class="mb-0"> Hecho con <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> usando el tema <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> .</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Etiquetas populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/tutorial/">Tutorial</a> <a class="post-tag" href="/tags/blueteam/">BlueTeam</a> <a class="post-tag" href="/tags/malware/">Malware</a> <a class="post-tag" href="/tags/ctf/">CTF</a> <a class="post-tag" href="/tags/cyberdefenders/">CyberDefenders</a> <a class="post-tag" href="/tags/forensics/">Forensics</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/ccd/">CCD</a> <a class="post-tag" href="/tags/certification/">Certification</a> <a class="post-tag" href="/tags/chromebook/">Chromebook</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">Hay una nueva versión de contenido disponible.</p><button type="button" class="btn btn-primary" aria-label="Update"> Actualizar </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">¡Oops! No se encuentran resultados.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/es.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-3C4BWDT0HM"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-3C4BWDT0HM'); }); </script>
