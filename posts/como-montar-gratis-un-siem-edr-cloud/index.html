<!DOCTYPE html><html lang="es-ES" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Como montar un SIEM y EDR en Elastic Cloud GRATIS" /><meta property="og:locale" content="es_ES" /><meta name="description" content="Vamos a aprender a como montar un SIEM con Elastic en Cloud con su EDR activado y además ponerlo a prueba en una máquina Windows virtual." /><meta property="og:description" content="Vamos a aprender a como montar un SIEM con Elastic en Cloud con su EDR activado y además ponerlo a prueba en una máquina Windows virtual." /><link rel="canonical" href="https://w47son.github.io/posts/como-montar-gratis-un-siem-edr-cloud/" /><meta property="og:url" content="https://w47son.github.io/posts/como-montar-gratis-un-siem-edr-cloud/" /><meta property="og:site_name" content="W4tson" /><meta property="og:image" content="https://w47son.github.io/assets/img/commons/elastic-setup/elasticTitle.gif" /><meta property="og:image:height" content="300" /><meta property="og:image:width" content="600" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-06-14T17:00:00+02:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://w47son.github.io/assets/img/commons/elastic-setup/elasticTitle.gif" /><meta property="twitter:title" content="Como montar un SIEM y EDR en Elastic Cloud GRATIS" /><meta name="twitter:site" content="@W4tson_Blue" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-06-14T17:57:08+02:00","datePublished":"2023-06-14T17:00:00+02:00","description":"Vamos a aprender a como montar un SIEM con Elastic en Cloud con su EDR activado y además ponerlo a prueba en una máquina Windows virtual.","headline":"Como montar un SIEM y EDR en Elastic Cloud GRATIS","image":{"width":600,"height":300,"url":"https://w47son.github.io/assets/img/commons/elastic-setup/elasticTitle.gif","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://w47son.github.io/posts/como-montar-gratis-un-siem-edr-cloud/"},"url":"https://w47son.github.io/posts/como-montar-gratis-un-siem-edr-cloud/"}</script><title>Como montar un SIEM y EDR en Elastic Cloud GRATIS | W4tson</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="W4tson"><meta name="application-name" content="W4tson"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://avatars.githubusercontent.com/u/54062322" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">W4tson</a></div><div class="site-subtitle font-italic">Blue Team | Certified Cyberdefender | CSIO</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>INICIO</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORÍAS</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>ETIQUETAS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVO</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ACERCA DE</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/w47son" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/W4tson_Blue" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="https://tryhackme.com/p/W4tson" aria-label="tryhackme" target="_blank" rel="noopener"> <i class="fa fa-cloud"></i> </a> <a href="https://cyberdefenders.org/profile/W4tson" aria-label="cyberdefenders" target="_blank" rel="noopener"> <i class="fa fa-user-secret"></i> </a> <a href="https://www.linkedin.com/in/juan-jose-manuel-sanchez/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Inicio </a> </span> <span>Como montar un SIEM y EDR en Elastic Cloud GRATIS</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Entrada</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Buscar..."> </span> <span id="search-cancel" >Cancelar</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Como montar un SIEM y EDR en Elastic Cloud GRATIS</h1><div class="post-meta text-muted"> <span> Publicado <em class="" data-ts="1686754800" data-df="YYYY-MM-DD" data-toggle="tooltip" data-placement="bottom"> 2023-06-14 </em> </span> <span> Actualizado <em class="" data-ts="1686758228" data-df="YYYY-MM-DD" data-toggle="tooltip" data-placement="bottom"> 2023-06-14 </em> </span><div class="mt-3 mb-3"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 600 300'%3E%3C/svg%3E" data-src="/assets/img/commons/elastic-setup/elasticTitle.gif" class="preview-img bg" alt="Preview Image" width="600" height="300" data-proofer-ignore></div><div class="d-flex justify-content-between"> <span> Por <em> <a href="https://github.com/w47son">W4tson</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="756 palabras"> <em>4 min</em> de lectura</span></div></div></div><div class="post-content"><p>Vamos a aprender a como montar un SIEM con Elastic en Cloud con su EDR activado y además ponerlo a prueba en una máquina Windows virtual.</p><h1 id="qué-es-un-siem">¿Qué es un SIEM?</h1><p>Un <strong>SIEM</strong> (Security Information and Event Management) es un <strong>programa de monitorización que recopila, analiza y correlaciona logs en tiempo real.</strong></p><p>Tener un SIEM es <strong>necesario</strong> por la capacidad de <strong>analizar logs</strong> fuera de la máquina, <strong>crear alertas</strong> en base a esos logs, integrar nuevas <strong>herramientas de detección y repuesta</strong> y al final correlacionar eventos en un entorno donde la <strong>comodidad</strong> y la <strong>velocidad</strong> de la muestra de los logs es importante.</p><h1 id="registro-elastic">Registro Elastic</h1><p>Lo primero de todo es registrarse en Elastic donde te darán <strong>15 días gratis</strong> sin pedir tarjeta</p><p><a href="https://cloud.elastic.co/registration" target="_blank">https://cloud.elastic.co/registration</a></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 350 350'%3E%3C/svg%3E" data-src="/assets/img/commons/elastic-setup/1.png" alt="Registro Elastic" width="350" height="350" class="center-image" data-proofer-ignore></p><p>Una vez registrado te pedirán algunos datos que te los puedes inventar</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 350 350'%3E%3C/svg%3E" data-src="/assets/img/commons/elastic-setup/2.png" alt="Registro Datos Elastic" width="350" height="350" class="center-image" data-proofer-ignore></p><p>Finalmente, nos pedirá donde crear nuestro deployment. Yo lo dejé <strong>por defecto</strong></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 450 550'%3E%3C/svg%3E" data-src="/assets/img/commons/elastic-setup/3.png" alt="Registro Deployment Elastic" width="450" height="550" class="center-image" data-proofer-ignore></p><h1 id="añadir-agentes">Añadir agentes</h1><p>Los <strong>agentes</strong> son programas diseñados para <strong>enviar información de los logs</strong> del host al Stack de Elastic. <br /> <br /></p><p>Para añadir un host y agregarle el agent vamos a instalar la <a href="https://www.microsoft.com/es-es/software-download/windows10" target="_blank">ISO de windows</a> en nuestro <strong>VMware</strong> o <strong>VirtualBox</strong>.</p><p>Después de hacer una correcta instalación de windows en nuestra máquina virtual, seguimos con la instalación del agente.</p><h2 id="paso-elastic"><span class="mr-2">Paso Elastic</span><a href="#paso-elastic" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Nos aparecerá esta interfaz donde haremos clic en <strong>Management - Fleet</strong></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 850 850'%3E%3C/svg%3E" data-src="/assets/img/commons/elastic-setup/4fleet.png" alt="Fleet Elastic" width="850" height="850" class="center-image" data-proofer-ignore></p><p>Después, hacemos clic en <strong>Add agent</strong></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 850 850'%3E%3C/svg%3E" data-src="/assets/img/commons/elastic-setup/5agent.png" alt="Add Agent Elastic" width="850" height="850" class="center-image" data-proofer-ignore></p><p>Creamos una policy llamada <strong>Windows</strong></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 850 850'%3E%3C/svg%3E" data-src="/assets/img/commons/elastic-setup/6agent.png" alt="Agent Elastic" width="850" height="850" class="center-image" data-proofer-ignore></p><p>Lo dejamos en <strong>recommended</strong> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 850 850'%3E%3C/svg%3E" data-src="/assets/img/commons/elastic-setup/7agent.png" alt="Agent Elastic" width="850" height="850" class="center-image" data-proofer-ignore></p><p>Aquí <strong>copiamos el código</strong> para pegarlo en un <strong>powershell con privilegios</strong> en la <strong>máquina Windows</strong> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 850 850'%3E%3C/svg%3E" data-src="/assets/img/commons/elastic-setup/8agent.png" alt="Agent Elastic" width="850" height="850" class="center-image" data-proofer-ignore></p><p><br /></p><h2 id="paso-windows"><span class="mr-2">Paso Windows</span><a href="#paso-windows" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>En nuestra máquina virtualizada iniciamos <strong>powershell como administrador</strong>.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 550 550'%3E%3C/svg%3E" data-src="/assets/img/commons/elastic-setup/9powershell.png" alt="Powershell Windows " width="550" height="550" class="center-image" data-proofer-ignore></p><p>Creamos una carpeta nueva y <strong>ejecutamos</strong> el código copiado de Elastic con <strong>botón derecho</strong></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 850 850'%3E%3C/svg%3E" data-src="/assets/img/commons/elastic-setup/10powershell.png" alt="Powershell Windows " width="850" height="850" class="center-image" data-proofer-ignore></p><p>Una vez finalice, en Elastic podremos ver que se ha completado correctamente.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 850 850'%3E%3C/svg%3E" data-src="/assets/img/commons/elastic-setup/11fleet.png" alt="Fleet Completado Windows " width="850" height="850" class="center-image" data-proofer-ignore></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 850 850'%3E%3C/svg%3E" data-src="/assets/img/commons/elastic-setup/12fleet.png" alt="Fleet Completado Windows " width="850" height="850" class="center-image" data-proofer-ignore></p><h1 id="instalación-de-sysmon">Instalación de Sysmon</h1><p><strong>Sysmon</strong> es una utilidad que <strong>monitorea Windows</strong> de una forma la cual te provee de logs con información detallada sobre procesos, conexiones de red y más. Es uno de los mejores logs para investigar.</p><p>Vamos a descargar <strong>Sysmon</strong> desde <a href="https://learn.microsoft.com/en-us/sysinternals/downloads/sysmon" target="_blank">aquí</a> y la <strong>configuración</strong> necesaria desde <a href="https://github.com/SwiftOnSecurity/sysmon-config/blob/master/sysmonconfig-export.xml" target="_blank">aquí</a></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 750 750'%3E%3C/svg%3E" data-src="/assets/img/commons/elastic-setup/13sysmon.png" alt="Sysmon Windows " width="750" height="750" class="center-image" data-proofer-ignore></p><p><br /> Una vez descargados, iniciamos <strong>powershell como administrador</strong> y ejecutamos el siguiente código</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="o">.</span><span class="n">\Sysmon64.exe</span><span class="w"> </span><span class="nt">-accepteula</span><span class="w"> </span><span class="nt">-i</span><span class="w"> </span><span class="o">.</span><span class="nx">\sysmonconfig-export.xml</span><span class="w">
</span></pre></table></code></div></div><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 650 860'%3E%3C/svg%3E" data-src="/assets/img/commons/elastic-setup/14sysmon.png" alt="Sysmon Windows" width="650" height="860" class="center-image" data-proofer-ignore></p><p><br /></p><p>Para ver que el servicio está corriendo correctamente, ejecutamos el siguiente código</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">Get-Service</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">findstr</span><span class="w"> </span><span class="s1">'Sysmon'</span><span class="w">
</span></pre></table></code></div></div><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 550 550'%3E%3C/svg%3E" data-src="/assets/img/commons/elastic-setup/15sysmon.png" alt="Sysmon Windows" width="550" height="550" class="center-image" data-proofer-ignore></p><p>Con esto hemos instalado Sysmon y nos hace falta poder enviarlo a Elastic</p><h1 id="instalación-de-integraciones">Instalación de Integraciones</h1><p>Para <strong>enviar todos los logs</strong> del agent de Windows, <strong>hay que instalar</strong> una integración a la política existente.</p><p><br /> Vamos a <strong>Management - Fleet - Agent Policy</strong> y hacemos clic en la política que creamos de <strong>Windows</strong></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 750 750'%3E%3C/svg%3E" data-src="/assets/img/commons/elastic-setup/16policy.png" alt="Policy Windows" width="750" height="750" class="center-image" data-proofer-ignore></p><p>Clicamos en <strong>Add integration</strong></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 750 750'%3E%3C/svg%3E" data-src="/assets/img/commons/elastic-setup/17policy.png" alt="Policy Windows" width="750" height="750" class="center-image" data-proofer-ignore></p><p>Buscamos <strong>Windows</strong>, <strong>hacemos clic</strong> y lo <strong>añadimos</strong></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 750 750'%3E%3C/svg%3E" data-src="/assets/img/commons/elastic-setup/18integration.png" alt="Integration Windows" width="750" height="750" class="center-image" data-proofer-ignore></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 750 750'%3E%3C/svg%3E" data-src="/assets/img/commons/elastic-setup/19integration.png" alt="Integration Windows" width="750" height="750" class="center-image" data-proofer-ignore></p><p>Dejamos todo como está y guardamos</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 750 750'%3E%3C/svg%3E" data-src="/assets/img/commons/elastic-setup/20integration.png" alt="Integration Windows" width="750" height="750" class="center-image" data-proofer-ignore></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 750 750'%3E%3C/svg%3E" data-src="/assets/img/commons/elastic-setup/21integration.png" alt="Integration Windows" width="750" height="750" class="center-image" data-proofer-ignore></p><p>Ahora podremos recopilar todos los logs de Sysmon de forma correcta y nos faltaría el EDR.</p><h1 id="instalación-del-edr">Instalación del EDR</h1><p>Un <strong>EDR</strong> (Endpoint Detection and Response) es una <strong>solución de seguridad</strong> diseñada para <strong>detectar</strong>, <strong>investigar y responder</strong> ante posibles <strong>amenazas</strong> de los endpoints conectados. Las técnicas de detección de un EDR son avanzadas y además nos provee de alertas a nuestro SIEM.</p><p>Para instalarlo hay que ir a <strong>integraciones</strong> y buscar <strong>Elastic Defend</strong></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 550 550'%3E%3C/svg%3E" data-src="/assets/img/commons/elastic-setup/22edr.png" alt="EDR Windows" width="550" height="550" class="center-image" data-proofer-ignore></p><p>Añadimos <strong>Elastic Defend</strong></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 750 750'%3E%3C/svg%3E" data-src="/assets/img/commons/elastic-setup/23edr.png" alt="EDR Windows" width="750" height="750" class="center-image" data-proofer-ignore></p><p>Lo dejamos todo por defecto</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 950 950'%3E%3C/svg%3E" data-src="/assets/img/commons/elastic-setup/24edr.png" alt="EDR Windows" width="950" height="950" class="center-image" data-proofer-ignore></p><p>Guardamos y desplegamos los cambios</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 650 650'%3E%3C/svg%3E" data-src="/assets/img/commons/elastic-setup/25edr.png" alt="EDR Windows" width="650" height="650" class="center-image" data-proofer-ignore></p><p><br /></p><h2 id="verificación-de-la-instalación"><span class="mr-2">Verificación de la instalación</span><a href="#verificación-de-la-instalación" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Buscamos en <strong>Security - Manage - Endpoints</strong> que todo se haya producido correctamente</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 750 750'%3E%3C/svg%3E" data-src="/assets/img/commons/elastic-setup/26edr.png" alt="EDR Windows" width="750" height="750" class="center-image" data-proofer-ignore></p><p>Una vez que nos aparezca nuestro host podremos: <br /> <strong>Aislar la máquina</strong>, <strong>ejecutar comandos</strong> con <strong>“Respond”</strong> para poder hacer de respuesta a incidentes (aunque no es la mejor opción) y <strong>ver todos los detalles del host</strong>.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 750 750'%3E%3C/svg%3E" data-src="/assets/img/commons/elastic-setup/27edr.png" alt="EDR Windows" width="750" height="750" class="center-image" data-proofer-ignore></p><p><br /></p><h2 id="añadir-reglas"><span class="mr-2">Añadir Reglas</span><a href="#añadir-reglas" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Vamos a <strong>añadir todas las reglas</strong> que nos proporciona <strong>Elastic Defend</strong> <br /> En <strong>Alerts</strong> hacemos clic en <strong>Manage Rules</strong></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 750 750'%3E%3C/svg%3E" data-src="/assets/img/commons/elastic-setup/28rules.png" alt="Rules Windows" width="750" height="750" class="center-image" data-proofer-ignore></p><p>Las <strong>seleccionamos todas</strong> y las <strong>habilitamos</strong> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 750 750'%3E%3C/svg%3E" data-src="/assets/img/commons/elastic-setup/29rules.png" alt="Rules Windows" width="750" height="750" class="center-image" data-proofer-ignore></p><h1 id="uso-del-edr">Uso del EDR</h1><h2 id="detección-doble-extensión"><span class="mr-2">Detección Doble extensión</span><a href="#detección-doble-extensión" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Para ponerlo a prueba vamos a <strong>copiar</strong> el <strong>ejecutable de la calculadora</strong> y vamos a añadir de nombre <strong>calc.jpg</strong> para que haga de <strong>doble extensión</strong> y lo ejecutamos.</p><p>Al iniciar la calculadora podemos ver que ha <strong>bloqueado la ejecución</strong> por tener doble extensión ya que es una técnica de <strong>Masquerading</strong> utilizada para <strong>engañar al usuario</strong>. <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 750 750'%3E%3C/svg%3E" data-src="/assets/img/commons/elastic-setup/30calc.png" alt="Calc Windows" width="750" height="750" class="center-image" data-proofer-ignore></p><p>Vamos al <strong>explorador de archivos</strong> y en <strong>vista</strong> marcamos <strong>Extensiones de nombre de archivo</strong></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 750 750'%3E%3C/svg%3E" data-src="/assets/img/commons/elastic-setup/31calc.png" alt="Calc Windows" width="750" height="750" class="center-image" data-proofer-ignore></p><p>Ahora podremos ver que realmente tenía <strong>doble extensión</strong> y estábamos intentando <strong>enmascarar la extensión</strong> real que era <strong>.exe</strong></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 150 150'%3E%3C/svg%3E" data-src="/assets/img/commons/elastic-setup/32calc.png" alt="Calc Windows" width="150" height="150" class="center-image" data-proofer-ignore></p><p>Esta incidencia ha aparecido en <strong>Alertas</strong> de <strong>Security</strong> (se ejecutó dos veces)</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 750 750'%3E%3C/svg%3E" data-src="/assets/img/commons/elastic-setup/33alert.png" alt="Alerta Windows" width="750" height="750" class="center-image" data-proofer-ignore></p><p>También si buscamos en Kibana <strong>calc.jpg</strong> nos aparece (Kibana se encuentra en <strong>Analytics - Discover</strong>)</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 750 750'%3E%3C/svg%3E" data-src="/assets/img/commons/elastic-setup/34kibana.png" alt="Alerta Windows" width="750" height="750" class="center-image" data-proofer-ignore></p><h2 id="detección-rtlo"><span class="mr-2">Detección RTLO</span><a href="#detección-rtlo" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Para probar otra <strong>técnica mas sofisticada</strong> hemos probado <strong>RTLO</strong> con esta herramienta <a href="https://github.com/BlackShell256/RTLO">https://github.com/BlackShell256/RTLO</a></p><p>Esta técnica haría <strong>bypass al antivirus</strong> pero sería <strong>bloqueado por el EDR</strong>.</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 750 750'%3E%3C/svg%3E" data-src="/assets/img/commons/elastic-setup/35rtlo.png" alt="Alerta Windows" width="750" height="750" class="center-image" data-proofer-ignore></p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 750 750'%3E%3C/svg%3E" data-src="/assets/img/commons/elastic-setup/36rtlo.png" alt="Alerta Windows" width="750" height="750" class="center-image" data-proofer-ignore></p><p>Para más información de este tipo de técnicas de <strong>Masquerading</strong> visita: <a href="https://attack.mitre.org/techniques/T1036/" target="_blank">https://attack.mitre.org/techniques/T1036/</a></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/tutorial/'>Tutorial</a>, <a href='/categories/siem/'>SIEM</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/tutorial/" class="post-tag no-text-decoration" >Tutorial</a> <a href="/tags/siem/" class="post-tag no-text-decoration" >SIEM</a> <a href="/tags/elastic/" class="post-tag no-text-decoration" >Elastic</a> <a href="/tags/edr/" class="post-tag no-text-decoration" >EDR</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> Esta entrada está licenciada bajo <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> por el autor.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Compartir</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Como+montar+un+SIEM+y+EDR+en+Elastic+Cloud+GRATIS+-+W4tson&url=https%3A%2F%2Fw47son.github.io%2Fposts%2Fcomo-montar-gratis-un-siem-edr-cloud%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fw47son.github.io%2Fposts%2Fcomo-montar-gratis-un-siem-edr-cloud%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fw47son.github.io%2Fposts%2Fcomo-montar-gratis-un-siem-edr-cloud%2F&text=Como+montar+un+SIEM+y+EDR+en+Elastic+Cloud+GRATIS+-+W4tson" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copiar enlace" data-title-succeed="¡Enlace copiado!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Actualizado recientemente</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/analisis-reporte-malware-chrome-stealer/">Análisis y reporte del chrome stealer - ChromeUpdater.exe</a><li><a href="/posts/certified-cyberdefender-review/">Certified CyberDefender (CCD) - Review de Certificación y Exámen</a><li><a href="/posts/como-montar-gratis-un-siem-edr-cloud/">Como montar un SIEM y EDR en Elastic Cloud GRATIS</a><li><a href="/posts/learning-blueteam/">¿Cómo empezar en el Blue Team?</a><li><a href="/posts/eli-challenge-writeup/">Eli Forensics Challenge | CyberDefenders</a></ul></div><div id="access-tags"><div class="panel-heading">Etiquetas populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/tutorial/">Tutorial</a> <a class="post-tag" href="/tags/blueteam/">BlueTeam</a> <a class="post-tag" href="/tags/malware/">Malware</a> <a class="post-tag" href="/tags/ctf/">CTF</a> <a class="post-tag" href="/tags/cyberdefenders/">CyberDefenders</a> <a class="post-tag" href="/tags/forensics/">Forensics</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/ccd/">CCD</a> <a class="post-tag" href="/tags/certification/">Certification</a> <a class="post-tag" href="/tags/chromebook/">Chromebook</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contenido</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Lecturas adicionales</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/malware-analysis-lab/"><div class="card-body"> <em class="small" data-ts="1664132400" data-df="YYYY-MM-DD" > 2022-09-25 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Configurar laboratorios para Análisis de Malware</h3><div class="text-muted small"><p> Para analizar un malware es necesario tener un entorno seguro con el que trabajar. Existen malwares tanto para Windows como Linux por lo que prepararemos ambos entornos. Para conseguirlo, hay que s...</p></div></div></a></div><div class="card"> <a href="/posts/learning-blueteam/"><div class="card-body"> <em class="small" data-ts="1668355200" data-df="YYYY-MM-DD" > 2022-11-13 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>¿Cómo empezar en el Blue Team?</h3><div class="text-muted small"><p> Una de las mejores formas de empezar en el mundo del Blue Team como en cualquier otro ámbito es practicar. Por ello, os voy a compartir las mejores páginas para darle caña a la parte defensiva : ...</p></div></div></a></div><div class="card"> <a href="/posts/memory-acquisition-windows/"><div class="card-body"> <em class="small" data-ts="1676232000" data-df="YYYY-MM-DD" > 2023-02-12 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Adquisición y análisis de memoria RAM en Windows</h3><div class="text-muted small"><p> La memoria volátil o memoria RAM, es una parte fundamental de las investigaciones forenses de los ordenadores. Contiene datos volátiles mientras el sistema operativo está en ejecución. La informaci...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/certified-cyberdefender-review/" class="btn btn-outline-primary" prompt="Anterior"><p>Certified CyberDefender (CCD) - Review de Certificación y Exámen</p></a> <a href="/posts/analisis-reporte-malware-chrome-stealer/" class="btn btn-outline-primary" prompt="Nuevo"><p>Análisis y reporte del chrome stealer - ChromeUpdater.exe</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/w47son">W4tson</a>. <span data-toggle="tooltip" data-placement="top" title="Salvo que se indique explícitamente, las entradas de este blog están licenciadas bajo la Creative Commons Attribution 4.0 International (CC BY 4.0) License por el autor.">Algunos derechos reservados.</span></p></div><div class="footer-right"><p class="mb-0"> Hecho con <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> usando el tema <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> .</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Etiquetas populares</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/tutorial/">Tutorial</a> <a class="post-tag" href="/tags/blueteam/">BlueTeam</a> <a class="post-tag" href="/tags/malware/">Malware</a> <a class="post-tag" href="/tags/ctf/">CTF</a> <a class="post-tag" href="/tags/cyberdefenders/">CyberDefenders</a> <a class="post-tag" href="/tags/forensics/">Forensics</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/ccd/">CCD</a> <a class="post-tag" href="/tags/certification/">Certification</a> <a class="post-tag" href="/tags/chromebook/">Chromebook</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">Hay una nueva versión de contenido disponible.</p><button type="button" class="btn btn-primary" aria-label="Update"> Actualizar </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">¡Oops! No se encuentran resultados.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/es.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-3C4BWDT0HM"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-3C4BWDT0HM'); }); </script>
